<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>BMI Rechner (gesch√ºtzt)</title>

    <style>
        #bmiSection { display: none; }
        #error { color: red; margin-top: 10px; }
    </style>
</head>
<body>

<!-- üîê LOGIN -->
<form id="loginForm">
    <h2>Login</h2>

    <label>Benutzername:</label><br>
    <input type="text" id="username" required><br><br>

    <label>Passwort:</label><br>
    <input type="password" id="password" required minlength="5"><br><br>

    <button type="submit">Einloggen</button>

    <div id="error"></div>
</form>

<!-- ‚öñÔ∏è BMI -->
<section id="bmiSection">
    <h2>BMI Rechner</h2>

    <label>Gr√∂√üe (cm):</label><br>
    <input type="number" id="height" required><br><br>

    <label>Gewicht (kg):</label><br>
    <input type="number" id="weight" required><br><br>

    <button id="calcBMI">BMI berechnen</button>

    <p id="bmiResult"></p>
</section>

<script>
// üîê Beim Laden pr√ºfen, ob Token existiert
document.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem('token');
    if (token) {
        unlockBMI();
    }
});

// üîê LOGIN
document.getElementById('loginForm').addEventListener('submit', async function (e) {
    e.preventDefault();

    const loginData = {
        username: document.getElementById('username').value.trim(),
        password: document.getElementById('password').value
    };

    try {
        const res = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(loginData)
        });

        if (!res.ok) throw new Error('HTTP Fehler');

        const data = await res.json();

        if (data.success && data.token) {
            localStorage.setItem('token', data.token);
            unlockBMI();
        } else {
            showError('Ung√ºltige Login-Daten.');
        }

    } catch {
        showError('Serverfehler. Bitte sp√§ter erneut versuchen.');
    }
});

// ‚öñÔ∏è BMI BERECHNUNG
document.getElementById('calcBMI').addEventListener('click', () => {
    const height = document.getElementById('height').value / 100;
    const weight = document.getElementById('weight').value;

    if (!height || !weight) {
        document.getElementById('bmiResult').textContent = 'Bitte alle Felder ausf√ºllen.';
        return;
    }

    const bmi = (weight / (height * height)).toFixed(2);
    document.getElementById('bmiResult').textContent = `Dein BMI: ${bmi}`;
});

// üîì UI freischalten
function unlockBMI() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('bmiSection').style.display = 'block';
}

// ‚ùå Fehler anzeigen
function showError(message) {
    const error = document.getElementById('error');
    error.textContent = message;
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Funktionale API Demo</title>
</head>
<body>

    <h1>Serverzeit</h1>
    <p id="time">Noch nicht geladen</p>

    <button onclick="loadTime()">Zeit laden</button><br><br>

    <button onclick="sendData()">Daten senden</button>

    <script>

// Skript Teil API 2

async function sendData() {

    // Endpoint-URL
    const url = "/api/data";

    // JSON-Daten vorbereiten
    const dataObject = {
        wert1: "Hallo",
        wert2: 123,
        wert3: true
    };


    try {
        // Request konfigurieren
        const response = await fetch(url, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(dataObject)
        });

        // Fehler wenn kein ok-Status
        if (!response.ok) {
            throw new Error("Response status: " + response.status);
        }

        // Ergebnis auslesen
        const result = await response.json();

        console.log("Antwort vom Server:");
        console.log(result);

    } catch (error) {
        console.error("Fehler beim Request:");
        console.error(error.message);
    }
}


// Skript Teil API 1

        // Diese Funktion Ã¤ndert den Text im <p>-Element
        function updateTime(text) {
            var timeElement = document.getElementById('time');
            timeElement.innerText = text;
        }

        // Diese Funktion ruft die API auf
        function loadTime() {

            // HTTP-Anfrage an den Server senden
            var request = fetch('/api/time');

            // Warten auf die Server-Antwort
            request.then(function(response) {

                // Antwort in JSON umwandeln
                var jsonData = response.json();

                jsonData.then(function(data) {

                    // Zeit aus dem JSON lesen
                    var serverTime = data.time;

                    // Zeit im HTML anzeigen
                    updateTime(serverTime);

                });

            }).catch(function(error) {

                // Falls etwas schiefgeht
                updateTime('Fehler beim Laden');

            });

        }

    </script>

</body>
</html>

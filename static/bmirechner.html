<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI- & Kalorien-Rechner</title>

    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">

    <link rel="stylesheet" href="css/grid.css">
    <link rel="stylesheet" href="css/menue.css">
    <link rel="stylesheet" href="css/style.css">

    <style>
        #bmiSection { display: block; } /* Formular immer sichtbar */
        #ergebnis { display: none; margin-top:10px; }
        #error { color:red; margin-top:10px; }
    </style>
</head>
<body>

<section class="wrapper">
    <header>
        <h1>BMI- & Kalorien-Rechner</h1>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="bmirechner.html" class="active">BMI-Rechner</a></li>
            <li><a href="daten.html">Daten</a></li>
            <li><a href="profil.html">Profil</a></li>
        </ul>
    </nav>

    <main>
        <!-- Login/Logout Button -->
        <button id="authBtn" type="button">Login</button>

        <div id="bmiSection">
            <form id="rechner-form">
                <input type="number" id="groesse" placeholder="Größe (cm)" required>
                <input type="number" id="gewicht" placeholder="Gewicht (kg)" required>
                <input type="number" id="alter" placeholder="Alter" required>

                <label>Geschlecht</label>
                <select id="geschlecht">
                    <option value="maennlich">Männlich</option>
                    <option value="weiblich">Weiblich</option>
                </select>

                <label>Aktivitätslevel</label>
                <select id="aktivitaet">
                    <option value="1.2">Niedrig aktiv</option>
                    <option value="1.55">Mittel aktiv</option>
                    <option value="1.75">Sehr aktiv</option>
                </select>

                <button type="submit">Berechnen</button>
            </form>

            <div id="ergebnis"></div>
        </div>
    </main>

    <footer></footer>
</section>

<!-- Auth & BMI Logik -->
<script src="js/projekt.js"></script>
<script src="js/auth.js"></script>

<script>
    // Ergebnis-Box zunächst ausblenden, wird in projekt.js beim Berechnen eingeblendet
    const form = document.getElementById('rechner-form');
    const ergebnisDiv = document.getElementById('ergebnis');

    form.addEventListener('submit', function(event){
        event.preventDefault();

        const groesse = Number(document.getElementById("groesse").value);
        const gewicht = Number(document.getElementById("gewicht").value);
        const alter = Number(document.getElementById("alter").value);
        const geschlecht = document.getElementById("geschlecht").value;
        const aktivitaet = Number(document.getElementById("aktivitaet").value);

        const groesseM = groesse / 100;
        const bmi = gewicht / (groesseM * groesseM);

        let grundumsatz;
        if(geschlecht === 'maennlich')
            grundumsatz = 10*gewicht + 6.25*groesse - 5*alter +5;
        else
            grundumsatz = 10*gewicht + 6.25*groesse - 5*alter -161;

        const kalorien = grundumsatz * aktivitaet;

        // Ergebnis sichtbar machen
        ergebnisDiv.style.display = 'block';
        ergebnisDiv.innerHTML = `
            <p>BMI: ${bmi.toFixed(1)}</p>
            <p>Kalorienbedarf: ${Math.round(kalorien)} kcal / Tag</p>
        `;

        // Optional: Profil speichern, falls eingeloggt
        const token = localStorage.getItem('token');
        if(token){
            fetch('/api/profile/save', {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({
                    token,
                    height: groesse,
                    weight: gewicht,
                    age: alter,
                    gender: geschlecht,
                    activity: aktivitaet,
                    bmi: bmi.toFixed(1),
                    calories: Math.round(kalorien)
                })
            });
        }
    });
</script>

</body>
</html>
